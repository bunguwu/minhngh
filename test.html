<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Personal Hub ‚Äî Profile ‚Ä¢ Timetable ‚Ä¢ Schedule ‚Ä¢ To-Do</title>
    <style>
        :root {
            --bg: #0b0f15;
            --card: #111826;
            --muted: #93a0b3;
            --text: #e8eef7;
            --accent: #6aa6ff;
            --accent2: #9bffb7;
            --danger: #ff6b6b;
            --warn: #ffd166;
            --ok: #2dd4bf;
            --ring: rgba(106, 166, 255, .35);
            --br: 16px;
            --pad: 14px;
            --gap: 14px;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #0a0e14, #0b111a);
            color: var(--text);
            font: 15px/1.45 system-ui, Segoe UI, Roboto, Inter, -apple-system, BlinkMacSystemFont
        }

        a {
            color: var(--accent);
            text-decoration: none
        }

        .wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 22px
        }

        .grid {
            display: grid;
            gap: var(--gap)
        }

        .cols {
            grid-template-columns: repeat(12, 1fr)
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .01));
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: var(--br);
            padding: var(--pad);
            box-shadow: var(--shadow)
        }

        .title {
            font-weight: 700;
            font-size: 20px;
            margin: 0 0 8px
        }

        .sub {
            color: var(--muted);
            font-size: 13px
        }

        .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .sp {
            flex: 1
        }

        .btn {
            border: 1px solid rgba(255, 255, 255, .12);
            background: #0f1520;
            color: var(--text);
            padding: 9px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: .2s;
            font-weight: 600
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, .35)
        }

        .btn.primary {
            background: linear-gradient(90deg, #4f8cff, #7bc8ff);
            color: #0b0f15;
            border: none
        }

        .btn.ghost {
            background: transparent
        }

        .btn.warn {
            background: linear-gradient(90deg, #ffd166, #ffb703);
            color: #1a1200;
            border: none
        }

        .btn.danger {
            background: linear-gradient(90deg, #ff6b6b, #ff8fab);
            color: #250b0b;
            border: none
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            background: #0f1623;
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, .12);
            outline: none
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--ring)
        }

        label {
            font-size: 12px;
            color: var(--muted)
        }

        .pill {
            display: inline-flex;
            gap: 6px;
            align-items: center;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .1);
            background: #0f1520
        }

        .list {
            display: grid;
            gap: 10px
        }

        .item {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            justify-content: space-between;
            padding: 10px;
            border: 1px dashed rgba(255, 255, 255, .12);
            border-radius: 12px
        }

        .muted {
            color: var(--muted)
        }

        .avatar {
            width: 88px;
            height: 88px;
            border-radius: 16px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, .15)
        }

        .kpi {
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        .kpi .pill {
            background: linear-gradient(90deg, rgba(106, 166, 255, .15), rgba(45, 212, 191, .15));
            border: none
        }

        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px
        }

        .col {
            background: #0f1623;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 12px;
            padding: 10px
        }

        .col h4 {
            margin: 0 0 6px;
            font-size: 14px;
            color: var(--muted)
        }

        .small {
            font-size: 12px
        }

        .badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .15)
        }

        .badge.ok {
            background: rgba(45, 212, 191, .15);
            border-color: rgba(45, 212, 191, .35)
        }

        .badge.hw {
            background: rgba(255, 209, 102, .15);
            border-color: rgba(255, 209, 102, .35)
        }

        .badge.due {
            background: rgba(255, 107, 107, .15);
            border-color: rgba(255, 107, 107, .45)
        }

        hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .12), transparent);
            margin: 8px 0
        }

        .empty {
            color: var(--muted);
            font-style: italic
        }

        /* Full-width boards use space intelligently */
        #classBoard {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        #lifeBoard {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        /* On wide screens, pin exact columns for clarity */
        @media (min-width: 1200px) {
            #classBoard {
                grid-template-columns: repeat(7, 1fr);
            }

            /* 7 ng√†y */
            #lifeBoard {
                grid-template-columns: repeat(4, 1fr);
            }

            /* S√°ng/Tr∆∞a/Chi·ªÅu/T·ªëi */
        }


        @media (max-width:1000px) {
            .cols {
                grid-template-columns: 1fr
            }
        }

        @media (max-width: 420px) {
            .col h4 {
                font-size: 13px
            }

            .item {
                padding: 8px
            }
        }
    </style>
</head>

<body>
    <div class="wrap grid cols">
        <!-- PROFILE -->
        <section class="card" style="grid-column: span 12">
            <div class="row">
                <img id="avatar" class="avatar" src="" alt="avatar" />
                <div class="sp">
                    <h2 class="title" id="name">Your Name</h2>
                    <div class="row small">
                        <span class="pill">üéÇ <span id="birthday">YYYY-MM-DD</span></span>
                        <span class="pill">üåç <span id="country">Country</span></span>
                        <span class="pill">üíû <span id="relationship">Relationship<a
                                    href="bunguwu.github.io/thaonguyencute">Th·∫£o Nguy√™n</a></span></span>
                    </div>
                    <p class="sub" id="bio" style="margin-top:8px">Short description‚Ä¶</p>
                    <div id="links" class="row small"></div>
                </div>
                <div class="row">
                    <button class="btn ghost" id="editProfileBtn">‚úèÔ∏è Edit</button>
                    <button class="btn" id="resetDataBtn" title="X√≥a d·ªØ li·ªáu local (kh√¥ng x√≥a CONFIG)">üßπ Reset
                        Local</button>
                </div>
            </div>
            <div class="kpi" style="margin-top:10px">
                <span class="pill">üìö L·ªõp h√¥m nay: <b id="kpi-classes">0</b></span>
                <span class="pill">üìù BTVN c√≤n l·∫°i: <b id="kpi-homework">0</b></span>
                <span class="pill">‚úÖ To-do ho√†n t·∫•t: <b id="kpi-done">0</b></span>
            </div>
        </section>

        <!-- TIMETABLE -->
        <section class="card" style="grid-column: span 12">

            <h3 class="title">üóìÔ∏è Th·ªùi kh√≥a bi·ªÉu </h3>

            <form id="classForm" class="grid" style="grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:10px">
                <div>
                    <label>Th·ª©</label>
                    <select name="day">
                        <option value="1">Th·ª© 2</option>
                        <option value="2">Th·ª© 3</option>
                        <option value="3">Th·ª© 4</option>
                        <option value="4">Th·ª© 5</option>
                        <option value="5">Th·ª© 6</option>
                        <option value="6">Th·ª© 7</option>
                        <option value="0">Ch·ªß nh·∫≠t</option>
                    </select>
                </div>
                <div><label>B·∫Øt ƒë·∫ßu</label><input name="start" type="time" required></div>
                <div><label>K·∫øt th√∫c</label><input name="end" type="time" required></div>
                <div><label>M√¥n</label><input name="subject" placeholder="To√°n, L√Ω‚Ä¶ " required></div>
                <div><label>Ghi ch√∫</label><input name="note" placeholder="Ph√≤ng, gi√°o vi√™n‚Ä¶"></div>
                <div>
                    <label>BTVN?</label>
                    <select name="homework">
                        <option value="no">Kh√¥ng</option>
                        <option value="yes">C√≥</option>
                    </select>
                </div>
                <div style="grid-column:span 6" class="row">
                    <button class="btn primary" type="submit">‚ûï Th√™m v√†o TKB</button>
                    <button class="btn ghost" type="button" id="clearClasses">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                </div>
            </form>

            <!-- 7 c·ªôt ng√†y c·ªë ƒë·ªãnh -->
            <div class="board" id="classBoard">
                <div class="col">
                    <h4>Th·ª© 2</h4>
                    <div class="list" data-day="1"></div>
                </div>
                <div class="col">
                    <h4>Th·ª© 3</h4>
                    <div class="list" data-day="2"></div>
                </div>
                <div class="col">
                    <h4>Th·ª© 4</h4>
                    <div class="list" data-day="3"></div>
                </div>
                <div class="col">
                    <h4>Th·ª© 5</h4>
                    <div class="list" data-day="4"></div>
                </div>
                <div class="col">
                    <h4>Th·ª© 6</h4>
                    <div class="list" data-day="5"></div>
                </div>
                <div class="col">
                    <h4>Th·ª© 7</h4>
                    <div class="list" data-day="6"></div>
                </div>
                <div class="col">
                    <h4>Ch·ªß nh·∫≠t</h4>
                    <div class="list" data-day="0"></div>
                </div>
            </div>

            <p class="small muted" style="margin-top:6px">G·ª£i √Ω: Click ‚úèÔ∏è ƒë·ªÉ s·ª≠a (auto-prefill form), üóëÔ∏è ƒë·ªÉ xo√°.</p>
        </section>

        <!-- WEEKLY LIFESTYLE -->
        <section class="card" style="grid-column: span 12">

            <h3 class="title">üß≠ L·ªãch sinh ho·∫°t</h3>
            <form id="lifeForm" class="grid" style="grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:10px">
                <div>
                    <label>Th·ª©</label>
                    <select name="day">
                        <option value="1">Th·ª© 2</option>
                        <option value="2">Th·ª© 3</option>
                        <option value="3">Th·ª© 4</option>
                        <option value="4">Th·ª© 5</option>
                        <option value="5">Th·ª© 6</option>
                        <option value="6">Th·ª© 7</option>
                        <option value="0">Ch·ªß nh·∫≠t</option>
                    </select>
                </div>
                <div>
                    <label>Khung gi·ªù</label>
                    <select name="block">
                        <option>S√°ng</option>
                        <option>Tr∆∞a</option>
                        <option>Chi·ªÅu</option>
                        <option>T·ªëi</option>
                    </select>
                </div>
                <div><label>Ho·∫°t ƒë·ªông</label><input name="title" placeholder="Gym / H·ªçc TSA / ƒêi b·ªô‚Ä¶" required></div>
                <div><label>Chi ti·∫øt</label><input name="note" placeholder="Ghi ch√∫‚Ä¶"></div>
                <div>
                    <label>L·∫∑p tu·∫ßn?</label>
                    <select name="repeat">
                        <option value="yes">C√≥</option>
                        <option value="no">Kh√¥ng</option>
                    </select>
                </div>
                <div class="row" style="align-items:end">
                    <button class="btn primary" type="submit">‚ûï Th√™m l·ªãch</button>
                </div>
            </form>
            <div class="board" id="lifeBoard">
                <div class="col">
                    <h4>üåÖ S√°ng</h4>
                    <div class="list" data-block="S√°ng"></div>
                </div>
                <div class="col">
                    <h4>üå§ Tr∆∞a</h4>
                    <div class="list" data-block="Tr∆∞a"></div>
                </div>
                <div class="col">
                    <h4>üåá Chi·ªÅu</h4>
                    <div class="list" data-block="Chi·ªÅu"></div>
                </div>
                <div class="col">
                    <h4>üåô T·ªëi</h4>
                    <div class="list" data-block="T·ªëi"></div>
                </div>
            </div>
        </section>

        <!-- TO-DO -->
        <section class="card" style="grid-column: span 12">
            <div class="row">
                <h3 class="title">‚úÖ To-Do</h3>
                <div class="sp"></div>
                <button class="btn warn" id="rollToTomorrow" title="Chuy·ªÉn vi·ªác ch∆∞a xong h√¥m nay sang ng√†y mai">‚è≠Ô∏è
                    Build ng√†y mai</button>
            </div>

            <!-- QUICK ADD -->
            <form id="todoForm" class="grid" style="grid-template-columns:repeat(6,1fr);gap:10px;margin:10px 0">
                <div style="grid-column:span 3"><label>Nhi·ªám v·ª•</label><input name="title"
                        placeholder="√în TSA ch∆∞∆°ng 1‚Ä¶" required></div>
                <div><label>H·∫°n</label><input name="due" type="date" required></div>
                <div><label>Tag</label><input name="tag" placeholder="H·ªçc/Gym/Vi·ªác nh√†‚Ä¶"></div>
                <div class="row" style="align-items:center;gap:8px">
                    <label class="small">ƒê√£ xong?</label>
                    <input name="done" type="checkbox" />
                </div>

                <div class="row" style="align-items:end"><button class="btn primary" type="submit">‚ûï Th√™m</button></div>
            </form>

            <!-- FILTER BAR -->
            <div id="todoFilters" class="row" style="gap:8px;margin:6px 0;flex-wrap:wrap">
                <div class="pill">
                    <label class="small" style="margin-right:6px">Tr·∫°ng th√°i</label>
                    <select id="fStatus">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="open">Ch∆∞a xong</option>
                        <option value="done">ƒê√£ xong</option>
                    </select>
                </div>
                <div class="pill">
                    <label class="small" style="margin-right:6px">H·∫°n</label>
                    <select id="fDue">
                        <option value="today">H√¥m nay</option>
                        <option value="overdue">Qu√° h·∫°n</option>
                        <option value="tomorrow">Ng√†y mai</option>
                        <option value="upcoming">S·∫Øp t·ªõi (‚â• h√¥m nay)</option>
                        <option value="all">T·∫•t c·∫£</option>
                    </select>
                </div>
                <div class="pill"><input id="fTag" placeholder="Tag (vd: H·ªçc/Gym‚Ä¶)" /></div>
                <div class="pill"><input id="fSearch" placeholder="T√¨m theo ti√™u ƒë·ªÅ‚Ä¶" /></div>
                <button class="btn ghost" id="fClear" type="button">Reset l·ªçc</button>
            </div>

            <!-- BULK ACTIONS -->
            <div class="row" style="gap:8px;margin:6px 0;flex-wrap:wrap">
                <span class="pill small">ƒê√£ ch·ªçn: <b id="selCount">0</b></span>
                <button class="btn" id="bulkDone" type="button">‚úÖ ƒê√°nh d·∫•u xong</button>
                <button class="btn danger" id="bulkDelete" type="button">üóëÔ∏è Xo√°</button>
            </div>

            <!-- LISTS -->
            <div class="grid" style="grid-template-columns:1fr 1fr;gap:10px">
                <div>
                    <h4 class="small muted">üìÖ View (theo b·ªô l·ªçc) ‚Äî <span id="todayLabel"></span></h4>
                    <div id="todoMain" class="list"></div>
                </div>
                <div>
                    <h4 class="small muted">üß© Ch∆∞a ho√†n th√†nh h√¥m nay</h4>
                    <div id="todoUnfinished" class="list"></div>
                </div>
            </div>
        </section>

    </div>

    <!-- EDIT PROFILE MODAL -->
    <dialog id="profileModal" style="border:none;border-radius:16px;padding:0;max-width:520px;width:92%">
        <form method="dialog" class="card" style="margin:0;background:#0f1623">
            <h3 class="title">‚úèÔ∏è C·∫≠p nh·∫≠t h·ªì s∆°</h3>
            <div class="grid" style="grid-template-columns:1fr 1fr;gap:10px">
                <div style="grid-column:span 2"><label>·∫¢nh (URL)</label><input name="avatar"></div>
                <div><label>H·ªç t√™n</label><input name="name" required></div>
                <div><label>Ng√†y sinh</label><input name="birthday" type="date"></div>
                <div><label>Qu·ªëc gia</label><input name="country"></div>
                <div><label>Quan h·ªá</label><input name="relationship"></div>
                <div><label>T√™n NY (hi·ªÉn th·ªã link)</label><input name="rel_label" placeholder="T√™n ng∆∞·ªùi y√™u"></div>
                <div><label>Link profile (URL)</label><input name="rel_url" placeholder="https://..."></div>

                <div style="grid-column:span 2"><label>M√¥ t·∫£</label><textarea name="bio" rows="3"></textarea></div>
                <div style="grid-column:span 2"><label>Links MXH (m·ªói d√≤ng: label|url)</label><textarea name="links"
                        rows="3" placeholder="Facebook|https://facebook.com/you"></textarea></div>
            </div>
            <div class="row" style="margin-top:10px">
                <button class="btn ghost" value="cancel">H·ªßy</button>
                <div class="sp"></div>
                <button class="btn primary" value="save">L∆∞u</button>
            </div>
        </form>
    </dialog>

    <script>
        /* ======= SIMPLE CONFIG (Ch·ªânh trong VS Code n·∫øu mu·ªën seed d·ªØ li·ªáu) ======= */

        const CONFIG = {
            profile: {
                avatar: "1.jpg  ",
                name: "Minh Ngh",
                birthday: "2008-11-14",
                country: "Vi·ªát Nam",
                relationship: "Single",
                relationship_link: { label: "", url: "" }, // ‚Üê NEW (optional)
                bio: "H·ªçc sinh 12, target HUST AI",
                links: [
                    ["Facebook", "https://facebook.com/yourpage"],
                    ["GitHub", "https://github.com/yourname"],
                    ["LinkedIn", "https://www.linkedin.com/in/yourname"]
                ]
            },
            samples: {
                classes: [
                    { day: 1, start: "07:00", end: "07:45", subject: "To√°n", note: "P101", homework: "yes" },
                    { day: 1, start: "08:00", end: "08:45", subject: "L√Ω", note: "P204", homework: "no" },
                    { day: 2, start: "09:00", end: "09:45", subject: "Anh", note: "GV Lan", homework: "yes" }
                ],
                life: [
                    { day: 1, block: "S√°ng", title: "Ch·∫°y b·ªô", note: "3km", repeat: "yes" },
                    { day: 1, block: "Chi·ªÅu", title: "Gym", note: "Push day", repeat: "yes" },
                    { day: 6, block: "T·ªëi", title: "Xem phim", note: "Th∆∞ gi√£n", repeat: "no" }
                ],
                todos: [
                    { title: "√în TSA ‚Äî B·∫•t ƒë·∫≥ng th·ª©c", due: todayStr(), done: false, tag: "H·ªçc" },
                    { title: "So·∫°n b√†i thuy·∫øt tr√¨nh", due: addDaysStr(1), done: false, tag: "H·ªçc" }
                ]
            }
        };

        /* ======= UTILITIES ======= */
        function uid() { return Math.random().toString(36).slice(2) + Date.now().toString(36); }

        let classEditingId = null; // ƒëang s·ª≠a l·ªõp n√†o (ID) hay kh√¥ng

        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
        const DAYS = ["CN", "T2", "T3", "T4", "T5", "T6", "T7"];

        function escapeHtml(s = "") {
            return s.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
        }
        function safeUrl(u = "") {
            try {
                const x = new URL(u.trim());
                if (x.protocol === "http:" || x.protocol === "https:") return x.href;
            } catch { }
            return ""; // reject non-http(s)
        }
        function renderRelationship(p) {
            const base = escapeHtml(p.relationship || "‚Äî");
            const linkObj = p.relationship_link || {};
            const label = (linkObj.label || "").trim();
            const url = safeUrl(linkObj.url || "");
            if (label && url) {
                return `${base} ( <a href="${url}" target="_blank" rel="noopener">` + escapeHtml(label) + `</a> )`;
            }
            // Back-compat: allow user to paste raw <a> in relationship field; sanitize to only <a href=http(s)>
            const raw = (p.relationship || "").trim();
            if (/<a\s[^>]*>.*<\/a>/i.test(raw)) {
                // very small sanitizer: keep only one anchor, strip others
                const m = raw.match(/<a\s+[^>]*href=["'](https?:\/\/[^"']+)["'][^>]*>(.*?)<\/a>/i);
                if (m) {
                    const url2 = safeUrl(m[1]);
                    const label2 = escapeHtml(m[2] || "link");
                    return `Dating with ( <a href="${url2}" target="_blank" rel="noopener">${label2}</a> )`;
                }
            }
            return base;
        }

        function cmpDate(a, b) { if (a === b) return 0; return a < b ? -1 : 1; }

        function todayStr() {
            const d = new Date();
            const iso = d.toISOString().slice(0, 10);
            return iso;
        }
        function addDaysStr(n, base = new Date()) {
            const d = new Date(base);
            d.setDate(d.getDate() + n);
            return d.toISOString().slice(0, 10);
        }

        /* ======= STORAGE LAYER ======= */
        const todoFilter = { status: 'all', due: 'today', tag: '', q: '' };
        let selectedIds = new Set();

        const KEY = {
            PROFILE: "ph_profile",
            CLASSES: "ph_classes",
            LIFE: "ph_life",
            TODOS: "ph_todos"
        };
        const store = {
            get(k, fallback) {
                try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch { return fallback; }
            },
            set(k, v) { localStorage.setItem(k, JSON.stringify(v)); },
            init() {
                if (!localStorage.getItem(KEY.PROFILE)) store.set(KEY.PROFILE, CONFIG.profile);
                if (!localStorage.getItem(KEY.CLASSES)) store.set(KEY.CLASSES, CONFIG.samples.classes);
                if (!localStorage.getItem(KEY.LIFE)) store.set(KEY.LIFE, CONFIG.samples.life);
                if (!localStorage.getItem(KEY.TODOS)) store.set(KEY.TODOS, CONFIG.samples.todos);
            },
            reset() {
                [KEY.PROFILE, KEY.CLASSES, KEY.LIFE, KEY.TODOS].forEach(k => localStorage.removeItem(k));
                store.init(); renderAll();
            }
        };

        /* ======= RENDER PROFILE ======= */
        function renderProfile() {
            const p = store.get(KEY.PROFILE, CONFIG.profile);
            $("#avatar").src = p.avatar || "";
            $("#name").textContent = p.name || "Your Name";
            $("#birthday").textContent = p.birthday || "YYYY-MM-DD";
            $("#country").textContent = p.country || "Country";
            $("#relationship").innerHTML = renderRelationship(p);

            $("#bio").textContent = p.bio || "";
            const links = $("#links"); links.innerHTML = "";
            (p.links || []).forEach(([label, url]) => {
                const a = document.createElement("a"); a.href = url; a.target = "_blank"; a.rel = "noopener";
                a.className = "pill"; a.textContent = label; links.appendChild(a);
            });
        }

        /* ======= RENDER CLASSES ======= */
        function renderClasses() {
            const data = store.get(KEY.CLASSES, []);
            // sort ·ªïn ƒë·ªãnh: ng√†y ‚Üí gi·ªù
            const sorted = [...data].sort((a, b) => (a.day - b.day) || a.start.localeCompare(b.start));

            // reset 7 c·ªôt
            $$('#classBoard .list').forEach(ul => ul.innerHTML = '');

            if (!sorted.length) {
                $$('#classBoard .list').forEach(ul => ul.innerHTML = `<div class="empty">Ch∆∞a c√≥ l·ªõp.</div>`);
                return;
            }

            sorted.forEach(c => {
                const container = $(`#classBoard .list[data-day="${c.day}"]`);
                const div = document.createElement('div'); div.className = 'item';
                div.innerHTML = `
      <div>
        <div class="row small">
          <span class="badge ok">${c.start}‚Äì${c.end}</span>
          ${c.homework === "yes" ? '<span class="badge hw">BTVN</span>' : ''}
        </div>
        <div style="margin-top:6px">
          <b>${c.subject}</b> <span class="muted">${c.note ? ('‚Ä¢ ' + c.note) : ''}</span>
        </div>
      </div>
      <div class="row">
        <button class="btn ghost" data-edit-class="${c.id}" title="S·ª≠a">‚úèÔ∏è</button>
        <button class="btn danger" data-del-class="${c.id}" title="Xo√°">üóëÔ∏è</button>
      </div>`;
                container?.appendChild(div);
            });

            // empty state cho c·ªôt tr·ªëng
            $$('#classBoard .list').forEach(ul => { if (!ul.children.length) ul.innerHTML = `<div class="empty">‚Äî</div>`; });

            // Xo√° theo ID (kh√¥ng l·ªách)
            $$('#classBoard [data-del-class]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.getAttribute('data-del-class');
                    const arr = store.get(KEY.CLASSES, []).filter(c => String(c.id) !== String(id));
                    store.set(KEY.CLASSES, arr);
                    if (classEditingId === id) classEditingId = null; // n·∫øu ƒëang s·ª≠a m·ª•c v·ª´a xo√°
                    renderClasses(); renderKPIs();
                };
            });

            // S·ª≠a: prefills + b·∫≠t edit mode (kh√¥ng remove tr∆∞·ªõc)
            $$('#classBoard [data-edit-class]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.getAttribute('data-edit-class');
                    const arr = store.get(KEY.CLASSES, []);
                    const c = arr.find(x => String(x.id) === String(id));
                    if (!c) return;

                    const f = $("#classForm");
                    f.day.value = c.day;
                    f.start.value = c.start;
                    f.end.value = c.end;
                    f.subject.value = c.subject;
                    f.note.value = c.note || "";
                    f.homework.value = c.homework || "no";

                    classEditingId = id; // b·∫≠t ch·∫ø ƒë·ªô s·ª≠a
                    // ƒë·ªïi n√∫t submit ƒë·ªÉ user nh·∫≠n bi·∫øt
                    const submitBtn = f.querySelector('button[type="submit"]');
                    if (submitBtn) { submitBtn.textContent = "üíæ L∆∞u thay ƒë·ªïi"; submitBtn.classList.add('primary'); }
                    f.scrollIntoView({ behavior: "smooth", block: "center" });
                };
            });
        }


        /* ======= RENDER LIFESTYLE (WEEKLY) ======= */
        function renderLife() {
            const data = store.get(KEY.LIFE, []);
            $$("#lifeBoard .list").forEach(ul => ul.innerHTML = "");
            if (!data.length) {
                $$("#lifeBoard .list").forEach(ul => ul.innerHTML = `<div class="empty">Ch∆∞a c√≥ m·ª•c n√†o.</div>`);
                return;
            }
            // group by block, then sort by day then title
            data.sort((a, b) => a.block.localeCompare(b.block) || (a.day - b.day) || a.title.localeCompare(b.title));
            data.forEach((it, idx) => {
                const container = $(`#lifeBoard .list[data-block="${it.block}"]`);
                const div = document.createElement("div"); div.className = "item";
                div.innerHTML = `
        <div>
          <div class="row small">
            <span class="badge">${DAYS[it.day]}</span>
            <span class="badge ${it.repeat === 'yes' ? 'ok' : ''}">${it.repeat === 'yes' ? 'L·∫∑p tu·∫ßn' : 'M·ªôt l·∫ßn'}</span>
          </div>
          <div style="margin-top:6px"><b>${it.title}</b> <span class="muted">${it.note ? ("‚Ä¢ " + it.note) : ""}</span></div>
        </div>
        <div class="row">
          <button class="btn ghost" data-life-edit="${idx}">‚úèÔ∏è</button>
          <button class="btn danger" data-life-del="${idx}">üóëÔ∏è</button>
        </div>`;
                container.appendChild(div);
            });
            $$("#lifeBoard [data-life-del]").forEach(btn => {
                btn.onclick = () => {
                    const i = +btn.dataset.lifeDel;
                    const arr = store.get(KEY.LIFE, []); arr.splice(i, 1); store.set(KEY.LIFE, arr); renderLife();
                };
            });
            $$("#lifeBoard [data-life-edit]").forEach(btn => {
                btn.onclick = () => {
                    const i = +btn.dataset.lifeEdit;
                    const arr = store.get(KEY.LIFE, []), it = arr[i];
                    const f = $("#lifeForm"); f.day.value = it.day; f.block.value = it.block;
                    f.title.value = it.title; f.note.value = it.note || ""; f.repeat.value = it.repeat || "yes";
                    arr.splice(i, 1); store.set(KEY.LIFE, arr); renderLife();
                    f.scrollIntoView({ behavior: "smooth", block: "center" });
                };
            });
        }

        /* ======= TO-DO ======= */
        function renderTodos() {
            const today = todayStr();
            $("#todayLabel").textContent = today;

            const data = store.get(KEY.TODOS, []);

            // View ch√≠nh theo b·ªô l·ªçc
            const main = data.filter(todoMatchesFilter).sort((a, b) => {
                if (a.done !== b.done) return a.done ? 1 : -1;
                const c = cmpDate(a.due, b.due); if (c !== 0) return c;
                return (a.title || '').localeCompare(b.title || '');
            });

            // Panel ‚Äúch∆∞a ho√†n th√†nh h√¥m nay‚Äù
            const unfinishedToday = data.filter(t => t.due === today && !t.done);

            const renderList = (root, items) => {
                root.innerHTML = "";
                if (!items.length) { root.innerHTML = `<div class="empty">Kh√¥ng c√≥ m·ª•c n√†o.</div>`; return; }
                items.forEach(t => {
                    const div = document.createElement("div"); div.className = "item";
                    const checked = selectedIds.has(String(t.id)) ? 'checked' : '';
                    div.innerHTML = `
        <div>
          <div class="row small">
            <label class="pill">
              <input type="checkbox" data-select="${t.id}" ${checked} style="margin-right:6px"/>
              <input type="checkbox" data-toggle="${t.id}" ${t.done ? "checked" : ""} style="margin:0 6px 0 0"/>${t.tag || "Task"}
            </label>
            <span class="badge ${cmpDate(t.due, today) === -1 && !t.done ? 'due' : ''}">Due: ${t.due}</span>
          </div>
          <div style="margin-top:6px"><b>${t.title}</b></div>
        </div>
        <div class="row">
          <button class="btn ghost" data-edit="${t.id}" title="S·ª≠a">‚úèÔ∏è</button>
          <button class="btn danger" data-del="${t.id}" title="Xo√°">üóëÔ∏è</button>
        </div>`;
                    root.appendChild(div);
                });
            };

            renderList($("#todoMain"), main);
            renderList($("#todoUnfinished"), unfinishedToday);

            // Toggle done
            $$('#todoMain [data-toggle], #todoUnfinished [data-toggle]').forEach(cb => {
                cb.onchange = () => {
                    const id = cb.getAttribute('data-toggle');
                    const arr = store.get(KEY.TODOS, []);
                    const i = arr.findIndex(x => String(x.id) === String(id));
                    if (i > -1) { arr[i].done = cb.checked; store.set(KEY.TODOS, arr); renderKPIs(); renderTodos(); }
                };
            });

            // Select for bulk
            $$('#todoMain [data-select]').forEach(cb => {
                cb.onchange = () => {
                    const id = cb.getAttribute('data-select');
                    if (cb.checked) selectedIds.add(String(id)); else selectedIds.delete(String(id));
                    $("#selCount").textContent = selectedIds.size;
                };
            });
            $("#selCount").textContent = selectedIds.size;

            // Delete
            $$('#todoMain [data-del], #todoUnfinished [data-del]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.getAttribute('data-del');
                    const arr = store.get(KEY.TODOS, []).filter(t => String(t.id) !== String(id));
                    selectedIds.delete(String(id));
                    store.set(KEY.TODOS, arr); renderTodos(); renderKPIs();
                }
            });

            $$('#todoMain [data-edit], #todoUnfinished [data-edit]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.getAttribute('data-edit');
                    const arr = store.get(KEY.TODOS, []);
                    const i = arr.findIndex(x => String(x.id) === String(id));
                    if (i > -1) {
                        const t = arr[i];
                        const f = $("#todoForm");
                        f.title.value = t.title;
                        f.due.value = t.due;
                        f.tag.value = t.tag || "";
                        if (f.done) f.done.checked = !!t.done;   // ‚Üê NEW: prefill checkbox

                        // remove b·∫£n c≈©, submit form s·∫Ω add l·∫°i (c√°ch s·ª≠a nhanh)
                        arr.splice(i, 1);
                        store.set(KEY.TODOS, arr);
                        renderTodos();
                        f.scrollIntoView({ behavior: "smooth", block: "center" });
                    }
                }
            });

        }

        function renderKPIs() {
            const classes = store.get(KEY.CLASSES, []);
            const todayDow = new Date().getDay();
            const classToday = classes.filter(c => +c.day === todayDow).length;
            const homework = classes.filter(c => c.homework === "yes").length;

            const todos = store.get(KEY.TODOS, []);
            const t = todayStr();
            const doneToday = todos.filter(x => x.due === t && x.done).length;

            $("#kpi-classes").textContent = classToday;
            $("#kpi-homework").textContent = homework;
            $("#kpi-done").textContent = doneToday;
        }


        /* ======= INIT + EVENTS ======= */

        function uid() {
            return Math.random().toString(36).slice(2) + Date.now().toString(36);
        }
        function ensureIds() {
            const arr = store.get(KEY.TODOS, []).map(t => ({ ...t, id: t.id ? String(t.id) : uid() }));
            store.set(KEY.TODOS, arr);
        }
        function todoMatchesFilter(t) {
            const today = todayStr();

            if (todoFilter.status === 'open' && t.done) return false;
            if (todoFilter.status === 'done' && !t.done) return false;

            if (todoFilter.due === 'today' && t.due !== today) return false;
            if (todoFilter.due === 'overdue' && !(cmpDate(t.due, today) === -1 && !t.done)) return false;
            if (todoFilter.due === 'tomorrow' && t.due !== addDaysStr(1)) return false;
            if (todoFilter.due === 'upcoming' && cmpDate(t.due, today) === -1) return false;

            if (todoFilter.tag) {
                const tg = (t.tag || '').toLowerCase(); if (!tg.includes(todoFilter.tag.toLowerCase())) return false;
            }
            if (todoFilter.q) {
                const ti = (t.title || '').toLowerCase(); if (!ti.includes(todoFilter.q.toLowerCase())) return false;
            }
            return true;
        }



        function renderAll() { renderProfile(); renderClasses(); renderLife(); ensureIds(); renderTodos(); renderKPIs(); }

        document.addEventListener("DOMContentLoaded", () => {
            store.init(function ensureClassIds() {
                const arr = store.get(KEY.CLASSES, []).map(c => ({ ...c, id: c.id ? String(c.id) : uid() }));
                store.set(KEY.CLASSES, arr);
            }); ensureIds(); renderAll();
            ensureClassIds();
            // Classes form


            // Defaults
            $("#todoForm [name='due']").value = todayStr();

            // Add
            $("#todoForm").onsubmit = (e) => {
                e.preventDefault();
                const f = e.target;
                const obj = {
                    id: uid(),
                    title: f.title.value.trim(),
                    due: f.due.value,
                    tag: f.tag.value.trim(),
                    done: !!f.done.checked
                };
                const arr = store.get(KEY.TODOS, []);
                arr.push(obj);
                store.set(KEY.TODOS, arr);

                // reset form v·ªÅ m·∫∑c ƒë·ªãnh
                f.reset();
                $("#todoForm [name='due']").value = todayStr();
                renderTodos(); renderKPIs();
            };

            // Filters
            $("#fStatus").onchange = e => { todoFilter.status = e.target.value; renderTodos(); renderKPIs(); };
            $("#fDue").onchange = e => { todoFilter.due = e.target.value; renderTodos(); renderKPIs(); };
            $("#fTag").oninput = e => { todoFilter.tag = e.target.value.trim(); renderTodos(); };
            $("#fSearch").oninput = e => { todoFilter.q = e.target.value.trim(); renderTodos(); };
            $("#fClear").onclick = () => {
                todoFilter.status = 'all'; todoFilter.due = 'today'; todoFilter.tag = ''; todoFilter.q = '';
                $("#fStatus").value = 'all'; $("#fDue").value = 'today'; $("#fTag").value = ''; $("#fSearch").value = '';
                renderTodos(); renderKPIs();
            };

            // Bulk ops
            $("#bulkDone").onclick = () => {
                if (selectedIds.size === 0) return;
                const arr = store.get(KEY.TODOS, []);
                arr.forEach(t => { if (selectedIds.has(String(t.id))) t.done = true; });
                store.set(KEY.TODOS, arr);
                selectedIds.clear(); $("#selCount").textContent = 0;
                renderTodos(); renderKPIs();
            };
            $("#bulkDelete").onclick = () => {
                if (selectedIds.size === 0) return;
                const arr = store.get(KEY.TODOS, []).filter(t => !selectedIds.has(String(t.id)));
                store.set(KEY.TODOS, arr);
                selectedIds.clear(); $("#selCount").textContent = 0;
                renderTodos(); renderKPIs();
            };

            // Rollover: MOVE unfinished today -> tomorrow
            $("#rollToTomorrow").onclick = () => {
                const arr = store.get(KEY.TODOS, []);
                const today = todayStr();
                const tomorrow = addDaysStr(1);
                let moved = 0;
                arr.forEach(t => { if (t.due === today && !t.done) { t.due = tomorrow; moved++; } });
                if (moved === 0) { alert("Tuy·ªát v·ªùi! Kh√¥ng c√≤n vi·ªác t·ªìn ƒë·ªçng h√¥m nay."); return; }
                store.set(KEY.TODOS, arr); renderTodos(); renderKPIs();
                alert(`ƒê√£ chuy·ªÉn ${moved} vi·ªác sang ng√†y mai (${tomorrow}).`);
            };

            // Profile modal
            $("#editProfileBtn").onclick = () => {
                const p = store.get(KEY.PROFILE, CONFIG.profile);
                const dlg = $("#profileModal");
                dlg.querySelector('[name="avatar"]').value = p.avatar || "";
                dlg.querySelector('[name="name"]').value = p.name || "";
                dlg.querySelector('[name="birthday"]').value = p.birthday || "";
                dlg.querySelector('[name="country"]').value = p.country || "";
                dlg.querySelector('[name="relationship"]').value = p.relationship || "";
                dlg.querySelector('[name="rel_label"]').value = (p.relationship_link?.label) || "";
                dlg.querySelector('[name="rel_url"]').value = (p.relationship_link?.url) || "";

                dlg.querySelector('[name="bio"]').value = p.bio || "";
                dlg.querySelector('[name="links"]').value = (p.links || []).map(([l, u]) => `${l}|${u}`).join("\n");
                dlg.showModal();
                dlg.addEventListener('close', () => {
                    if (dlg.returnValue === "save") {
                        const np = {
                            avatar: dlg.querySelector('[name="avatar"]').value.trim(),
                            name: dlg.querySelector('[name="name"]').value.trim(),
                            birthday: dlg.querySelector('[name="birthday"]').value,
                            country: dlg.querySelector('[name="country"]').value.trim(),
                            relationship: dlg.querySelector('[name="relationship"]').value.trim(),
                            bio: dlg.querySelector('[name="bio"]').value.trim(),
                            links: dlg.querySelector('[name="links"]').value.split("\n").filter(Boolean).map(line => {
                                const [label, url] = line.split("|"); return [(label || "").trim(), (url || "").trim()];
                            }),
                            relationship_link: {
                                label: dlg.querySelector('[name="rel_label"]').value.trim(),
                                url: dlg.querySelector('[name="rel_url"]').value.trim()
                            }
                        };

                        store.set(KEY.PROFILE, np); renderProfile();
                    }
                }, { once: true });
            };

            $("#resetDataBtn").onclick = () => {
                if (confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu local v√† n·∫°p l·∫°i t·ª´ CONFIG?")) store.reset();
            };

            // Class form
            $("#classForm").onsubmit = (e) => {
                e.preventDefault();
                const f = e.target;
                const payload = {
                    day: +f.day.value,
                    start: f.start.value,
                    end: f.end.value,
                    subject: f.subject.value.trim(),
                    note: (f.note.value || "").trim(),
                    homework: f.homework.value
                };

                const arr = store.get(KEY.CLASSES, []);
                if (classEditingId) {
                    // UPDATE theo ID
                    const i = arr.findIndex(c => String(c.id) === String(classEditingId));
                    if (i > -1) arr[i] = { ...arr[i], ...payload }; // gi·ªØ nguy√™n id
                    classEditingId = null;
                } else {
                    // CREATE
                    arr.push({ id: uid(), ...payload });
                }
                store.set(KEY.CLASSES, arr);

                // reset form + n√∫t
                f.reset();
                const submitBtn = f.querySelector('button[type="submit"]');
                if (submitBtn) { submitBtn.textContent = "‚ûï Th√™m v√†o TKB"; }

                renderClasses(); renderKPIs();
            };

            $("#clearClasses").onclick = () => {
                if (confirm("X√≥a to√†n b·ªô th·ªùi kh√≥a bi·ªÉu?")) { store.set(KEY.CLASSES, []); renderClasses(); renderKPIs(); }
            };

            // Life form
            $("#lifeForm").onsubmit = (e) => {
                e.preventDefault();
                const f = e.target;
                const obj = {
                    day: +f.day.value, block: f.block.value, title: f.title.value.trim(),
                    note: f.note.value.trim(), repeat: f.repeat.value
                };
                const arr = store.get(KEY.LIFE, []); arr.push(obj); store.set(KEY.LIFE, arr);
                f.reset(); renderLife();
            };

            // To-do form
            $("#todoForm").onsubmit = (e) => {
                e.preventDefault();
                const f = e.target;
                const obj = {
                    id: (Date.now() + Math.random()).toString(36),
                    title: f.title.value.trim(), due: f.due.value, tag: f.tag.value.trim(), done: false
                };
                const arr = store.get(KEY.TODOS, []); arr.push(obj); store.set(KEY.TODOS, arr);
                f.reset(); renderTodos(); renderKPIs();
            };
            $("#rollToTomorrow").onclick = () => {
                const arr = store.get(KEY.TODOS, []);
                const today = todayStr();
                const tomorrow = addDaysStr(1);
                let moved = 0;

                // MOVE: chuy·ªÉn h·∫°n c√°c vi·ªác ch∆∞a xong h√¥m nay sang ng√†y mai (kh√¥ng t·∫°o b·∫£n sao)
                arr.forEach(t => {
                    if (t.due === today && !t.done) {
                        t.due = tomorrow;
                        moved++;
                    }
                });

                if (moved === 0) {
                    alert("Tuy·ªát v·ªùi! Kh√¥ng c√≤n vi·ªác t·ªìn ƒë·ªçng h√¥m nay.");
                    return;
                }
                store.set(KEY.TODOS, arr);
                renderTodos();
                renderKPIs();
                alert(`ƒê√£ chuy·ªÉn ${moved} vi·ªác sang ng√†y mai (${tomorrow}).`);
            };
            const fd = $("#todoForm [name='done']"); if (fd) fd.checked = false;

        });

    </script>
</body>

</html>