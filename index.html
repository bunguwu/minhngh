<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Hub ‚Äî Profile ‚Ä¢ Timetable ‚Ä¢ Routine ‚Ä¢ To‚ÄëDo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* THEME: Light (default) */
    :root {
      --bg:#F5F7FA;
      --surface:#FFFFFF;
      --primary:#00ADB5;
      --primary-dark:#008a91;
      --text:#1E293B;
      --text-light:#64748B;
      --border:#E2E8F0;
      --chip:#F0FDFF;
    }
    /* THEME: Dark (ColorHunt 222831/393E46/00ADB5/EEEEEE) */
    [data-theme="dark"]{
      --bg:#222831;
      --surface:#393E46;
      --primary:#00ADB5;
      --primary-dark:#0199a0;
      --text:#EEEEEE;
      --text-light:#C7D2FE;
      --border:#2F3742;
      --chip:#2b3a3f;
    }

    body { background:var(--bg); color:var(--text); }
    .card { background:var(--surface); border-radius:1rem; border:1px solid var(--border); box-shadow:0 6px 18px rgba(0,0,0,0.05); }
    .tab-active { background:var(--primary)!important; color:#fff!important; border-color:var(--primary)!important; }
    .btn { background:var(--primary); color:#fff; border-radius:0.75rem; padding:0.5rem 1rem; font-size:0.875rem; font-weight:600; transition:transform .06s ease, background .2s; }
    .btn:active{ transform:translateY(1px); }
    .btn:hover { background:var(--primary-dark); }
    input,textarea,select { border:1px solid var(--border); border-radius:0.75rem; padding:0.6rem 0.8rem; background:var(--surface); color:var(--text); }
    label { color:var(--text-light); font-size:0.875rem; }
    .chip{ background:var(--chip); border:1px solid var(--border); padding:.25rem .6rem; border-radius:999px; font-weight:600; color:var(--primary); display:inline-block }
  </style>
</head>
<body class="min-h-screen">
  <!-- Top Bar -->
  <div class="sticky top-0 z-20 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="container mx-auto px-4 py-3 flex items-center gap-2">
      <div class="font-semibold text-lg text-[var(--primary)]">Personal Hub</div>
      <div class="ml-auto flex gap-2">
        <button id="themeToggle" class="btn" title="Chuy·ªÉn theme">üåô Dark</button>
        <button id="buildTomorrowBtn" class="btn">Build Tomorrow</button>
        <button id="exportBtn" class="btn">Export</button>
        <label class="btn cursor-pointer">
          Import
          <input id="importInput" type="file" accept="application/json" class="hidden" />
        </label>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4">
    <div id="notice" class="hidden mt-3 rounded-xl bg-[var(--primary)]/10 border border-[var(--primary)] p-3 text-sm text-[var(--text)]"></div>

    <!-- Tabs -->
    <div class="flex gap-2 mt-4 mb-6">
      <button data-tab="profile" class="tab px-4 py-2 rounded-xl border">Profile</button>
      <button data-tab="timetable" class="tab px-4 py-2 rounded-xl border">Th·ªùi kho√° bi·ªÉu</button>
      <button data-tab="routine" class="tab px-4 py-2 rounded-xl border">L·ªãch sinh ho·∫°t</button>
      <button data-tab="todos" class="tab px-4 py-2 rounded-xl border">To‚ÄëDo</button>
    </div>

    <!-- Profile -->
    <section id="tab-profile" class="card p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-[var(--primary)]">Th√¥ng tin c√° nh√¢n</h2>
        <div class="text-sm text-[var(--text-light)] space-x-4">
          <span id="dobDisplay"></span>
          <span id="relationshipDisplay"></span>
        </div>
        <button id="saveProfile" class="btn text-sm">Save</button>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <img id="avatarPreview" src="https://images.unsplash.com/photo-1527980965255-d3b416303d12?q=80&w=500&auto=format&fit=crop" alt="avatar" class="w-full aspect-square object-cover rounded-2xl border"/>
        </div>
        <div>
          <div class="grid grid-cols-2 gap-3">
            <input id="name" placeholder="H·ªç t√™n" />
            <input id="email" placeholder="Email" />
            <input id="phone" placeholder="SƒêT" />
            <input id="location" placeholder="ƒê·ªãa ƒëi·ªÉm" />
            <input id="dob" type="date" class="col-span-2" placeholder="Ng√†y sinh" />
          </div>
          <textarea id="description" class="mt-3 w-full" rows="3" placeholder="M√¥ t·∫£ / m·ª•c ti√™u"></textarea>

          <div class="mt-4">
            <h3 class="font-medium mb-1">T√¨nh tr·∫°ng</h3>
            <textarea id="relationship" class="w-full" rows="2" placeholder='VD: H·∫πn h√≤ v·ªõi <a href="https://bunguwu.github.io/thaonguyencute" target="_blank">Th·∫£o Nguy·ªÖn</a>'></textarea>
      
          </div>

          <div class="mt-4">
            <div class="flex items-center justify-between">
              <h3 class="font-medium">Li√™n k·∫øt MXH</h3>
              <button id="addSocial" class="text-sm text-[var(--primary)]">+ Th√™m</button>
            </div>
            <div id="socials" class="mt-2 space-y-2"></div>
          </div>

          <div class="mt-4">
            <div class="flex items-center justify-between">
              <h3 class="font-medium">Danh hi·ªáu theo nƒÉm</h3>
              <button id="addAchievement" class="text-sm text-[var(--primary)]">+ Th√™m</button>
            </div>
            <div id="achievements" class="mt-2 space-y-2"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Timetable -->
    <section id="tab-timetable" class="hidden card p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-[var(--primary)]">Th√¥ng tin c√° nh√¢n</h2>
        <div class="text-sm text-[var(--text-light)] space-x-4">
          <span id="dobDisplay"></span>
          <span id="relationshipDisplay"></span>
        </div>
        <button id="saveProfile" class="btn text-sm">Save</button>
      </div>
      <div id="timetableWrap" class="grid md:grid-cols-2 gap-4"></div>
    </section>

    <!-- Routine -->
    <section id="tab-routine" class="hidden card p-6 mb-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-[var(--primary)]">Th√¥ng tin c√° nh√¢n</h2>
        <div class="text-sm text-[var(--text-light)] space-x-4">
          <span id="dobDisplay"></span>
          <span id="relationshipDisplay"></span>
        </div>
        <button id="saveProfile" class="btn text-sm">Save</button>
      </div>
      <div id="routineWrap" class="space-y-4"></div>
    </section>

    <!-- Todos -->
    <section id="tab-todos" class="hidden card p-6 mb-6">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-semibold text-[var(--primary)]">To‚ÄëDo & K·∫øt chuy·ªÉn</h2>
        <div class="text-sm text-[var(--text-light)]">H√¥m nay: <span id="todayBadge"></span></div>
      </div>
      <div class="flex flex-col md:flex-row gap-2 mb-3">
        <input id="todoText" placeholder="Nhi·ªám v·ª•" class="flex-1" />
        <input id="todoDue" type="date" />
        <button id="todoAdd" class="btn">Th√™m</button>
      </div>
      <div id="todoGroups" class="space-y-4"></div>
    </section>

    <footer class="text-center text-xs text-[var(--text-light)] pb-8">Local-first ‚Ä¢ Auto-save ‚Ä¢ No backend ‚Ä¢ HTML + Tailwind</footer>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'personal_hub_html_v2';
  const THEME_KEY = 'personal_hub_theme';
  const weekdays = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const timeBlocks = [
    {id:'morning', label:'S√°ng'},
    {id:'noon', label:'Tr∆∞a'},
    {id:'afternoon', label:'Chi·ªÅu'},
    {id:'evening', label:'T·ªëi'}
  ];
  const todayISO = () => new Date().toISOString().slice(0,10);
  const addDays = (iso, d)=>{const dt=new Date(iso); dt.setDate(dt.getDate()+d); return dt.toISOString().slice(0,10)};
  const uid = ()=>Math.random().toString(36).slice(2,10);

  const defaultData = {
    meta:{lastOpened: todayISO()},
    profile:{
      name:'Your Name',
      description:'M·ª•c ti√™u: AI-driven entrepreneur. H·ªçc TSA, build s·∫£n ph·∫©m AI.',
      basics:{email:'you@example.com', phone:'+84 xxx', location:'VN'},
      socials:[{id:uid(),label:'Facebook',url:'https://facebook.com/'}],
      achievements:[{id:uid(),year:new Date().getFullYear(), title:'Top 1 l·ªõp To√°n'}],
      dob:'',
      relationshipHTML:'H·∫πn h√≤ v·ªõi <a href="https://bunguwu.github.io/thaonguyencute" target="_blank">Th·∫£o Nguy·ªÖn</a>'
    },
    timetable:Object.fromEntries(weekdays.map(d=>[d,[
      {id:uid(),subject:'To√°n',note:'Ch∆∞∆°ng ƒë·∫°o h√†m',homework:true, hwNote:'BTVN 1-20, h·∫°n th·ª© 6'},
      {id:uid(),subject:'V·∫≠t l√Ω',note:'ƒêi·ªán xoay chi·ªÅu',homework:false}
    ]])),
    routine:Object.fromEntries(weekdays.map(d=>[d,{
      morning:[{id:uid(),title:'Gym UL/PPL',notes:"45'",recurring:true}],
      noon:[],
      afternoon:[{id:uid(),title:'H·ªçc TSA (To√°n)',notes:"90'",recurring:true}],
      evening:[{id:uid(),title:'Ti·∫øng Anh (IELTS)',notes:"60'",recurring:true}],
      events:[]
    }])),
    todos:[
      {id:uid(),text:'√în 20 c√¢u TSA d·∫°ng ƒë·ªì th·ªã', due: todayISO(), done:false},
      {id:uid(),text:'Vi·∫øt 300 ch·ªØ VƒÉn (C·ªè Lau)', due: todayISO(), done:false}
    ]
  };

  // State
  let db = load();

  // Boot
  initTheme();
  initTabs();
  hydrateProfile();
  renderTimetable();
  renderRoutine();
  renderTodos();
  attachTopbar();
  autoCarryOverIfNewDay();

  // THEME
  function initTheme(){
    const saved = localStorage.getItem(THEME_KEY) || 'light';
    applyTheme(saved);
    const btn = document.getElementById('themeToggle');
    if(btn){
      btn.onclick = ()=>{
        const next = (document.documentElement.getAttribute('data-theme')==='dark') ? 'light' : 'dark';
        applyTheme(next);
      };
    }
  }
  function applyTheme(mode){
    if(mode==='dark'){
      document.documentElement.setAttribute('data-theme','dark');
      localStorage.setItem(THEME_KEY,'dark');
      const btn = document.getElementById('themeToggle'); if(btn) btn.textContent='‚òÄÔ∏è Light';
    }else{
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem(THEME_KEY,'light');
      const btn = document.getElementById('themeToggle'); if(btn) btn.textContent='üåô Dark';
    }
  }

  // Utils
  function load(){
    try{const raw=localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw): structuredClone(defaultData);}catch(e){return structuredClone(defaultData)}
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
  function notify(msg){
    const el=document.getElementById('notice');
    el.textContent=msg; el.classList.remove('hidden');
    setTimeout(()=>el.classList.add('hidden'), 3000);
  }

  // Tabs
  function initTabs(){
    const tabs=[...document.querySelectorAll('.tab')];
    const sections={
      profile: document.getElementById('tab-profile'),
      timetable: document.getElementById('tab-timetable'),
      routine: document.getElementById('tab-routine'),
      todos: document.getElementById('tab-todos')
    };
    function setTab(id){
      tabs.forEach(t=> t.classList.toggle('tab-active', t.dataset.tab===id));
      Object.entries(sections).forEach(([k,sec])=> sec.classList.toggle('hidden', k!==id));
    }
    tabs.forEach(t=> t.addEventListener('click', ()=> setTab(t.dataset.tab)));
    setTab('profile');
  }

  // Profile
  function hydrateProfile(){
    const p = db.profile;
    const name = byId('name');
    const email = byId('email');
    const phone = byId('phone');
    const location = byId('location');
    const description = byId('description');
    const dob = byId('dob');
    const relationship = byId('relationship');
    const relPrev = byId('relationshipPreview');

    name.value=p.name; email.value=p.basics.email; phone.value=p.basics.phone; location.value=p.basics.location; description.value=p.description;
    dob.value = p.dob || '';
    relationship.value = p.relationshipHTML || '';
    if(relPrev) relPrev.innerHTML = relationship.value || '';

    // socials
    const socialsWrap = byId('socials');
    function renderSocials(){
      socialsWrap.innerHTML='';
      p.socials.forEach((s,idx)=>{
        const row = el('div', 'flex gap-2');
        const label = input('border rounded-xl p-2 flex-1', s.label, 'Nh√£n (Facebook, GitHub...)');
        const url = input('border rounded-xl p-2 flex-[2]', s.url, 'URL');
        const del = button('text-xs text-red-500', 'Xo√°');
        label.addEventListener('input', ()=> s.label=label.value);
        url.addEventListener('input', ()=> s.url=url.value);
        del.addEventListener('click', ()=>{ p.socials.splice(idx,1); renderSocials();
    // live preview for relationship
    if(relationship){
      relationship.addEventListener('input', ()=>{ if(relPrev){ relPrev.innerHTML = relationship.value; } p.relationshipHTML = relationship.value; save(); });
    } save(); });
        row.append(label,url,del); socialsWrap.append(row);
      })
      save();
    }
    renderSocials();
    byId('addSocial').onclick = ()=>{ p.socials.push({id:uid(),label:'',url:''}); renderSocials(); };

    // achievements
    const achWrap = byId('achievements');
    function renderAch(){
      achWrap.innerHTML='';
      p.achievements.forEach((a,idx)=>{
        const row = el('div','grid grid-cols-6 gap-2 items-center');
        const year = input('border rounded-xl p-2 col-span-2', a.year, 'NƒÉm', 'number');
        const title = input('border rounded-xl p-2 col-span-4', a.title, 'Danh hi·ªáu');
        year.addEventListener('input', ()=> a.year = Number(year.value||new Date().getFullYear()));
        title.addEventListener('input', ()=> a.title = title.value);
        row.append(year,title); achWrap.append(row);
      });
      save();
    }
    renderAch();
    byId('addAchievement').onclick = ()=>{ p.achievements.push({id:uid(),year:new Date().getFullYear(), title:''}); renderAch(); };

    byId('saveProfile').onclick = ()=>{
      db.profile = {
        ...p,
        name: name.value,
        description: description.value,
        dob: dob.value || '',
        relationshipHTML: relationship.value || '',
        basics:{ email: email.value, phone: phone.value, location: location.value },
      };
      save();
      notify('ƒê√£ l∆∞u h·ªì s∆°');
    }
  }

  // Timetable with homework note
  function renderTimetable(){
    const wrap = byId('timetableWrap');
    wrap.innerHTML='';
    weekdays.forEach((d)=>{
      const card = el('div','border rounded-2xl p-4');
      const header = el('div','flex items-center justify-between mb-3');
      const titleWrap = el('div','flex items-center gap-2');
      const chip = el('span','chip', d);
      titleWrap.append(chip);
      header.append(titleWrap);
      const addBtn = button('text-sm text-[var(--primary)]','+ M√¥n');
      header.append(addBtn);
      card.append(header);
      const list = el('div','space-y-2');
      card.append(list);
      wrap.append(card);

      function draw(){
        list.innerHTML='';
        db.timetable[d].forEach((r,idx)=>{
          const row = el('div','grid grid-cols-12 gap-2 items-center');
          const subj = input('border rounded-xl p-2 col-span-3', r.subject,'M√¥n');
          const note = input('border rounded-xl p-2 col-span-6', r.note,'Ghi ch√∫');
          const label = el('label','col-span-1 flex items-center gap-1 text-sm');
          const cb = document.createElement('input'); cb.type='checkbox'; cb.checked=!!r.homework; cb.addEventListener('change',()=>{ r.homework = cb.checked; if(!cb.checked){ delete r.hwNote; } save(); draw(); });
          label.append(cb, el('span','', 'HW'));
          const del = button('text-xs text-red-500 col-span-2','Xo√°');
          del.onclick=()=>{ db.timetable[d].splice(idx,1); save(); draw(); };
          subj.oninput=()=>{ r.subject=subj.value; save(); };
          note.oninput=()=>{ r.note=note.value; save(); };
          row.append(subj,note,label,del);
          list.append(row);

          if (r.homework){
            const hwRow = el('div','grid grid-cols-12 gap-2');
            const hw = input('border rounded-xl p-2 col-span-12', r.hwNote || '', 'Ghi ch√∫ BTVN (y√™u c·∫ßu, deadline, t√†i li·ªáu...)');
            hw.oninput = ()=>{ r.hwNote = hw.value; save(); };
            hwRow.append(hw);
            list.append(hwRow);
          }
        });
      }
      draw();
      addBtn.onclick = ()=>{ db.timetable[d].push({id:uid(),subject:'',note:'',homework:false}); save(); draw(); };
    });
  }

  // Routine
  function renderRoutine(){
    const wrap = byId('routineWrap');
    wrap.innerHTML='';
    weekdays.forEach((d)=>{
      const dayCard = el('div','border rounded-2xl p-4');
      const header = el('div','flex items-center justify-between');
      header.append(el('h3','font-semibold', d));
      const addEventBtn = button('text-sm text-[var(--primary)]','+ S·ª± ki·ªán');
      addEventBtn.onclick = ()=>{ db.routine[d].events.push({id:uid(),title:'S·ª± ki·ªán',time:'',notes:'',recurring:false}); save(); draw(); };
      header.append(addEventBtn);
      dayCard.append(header);

      const grid = el('div','grid md:grid-cols-2 gap-3 mt-3');
      dayCard.append(grid);

      function blockUI(blockId,label){
        const box = el('div','bg-slate-50 rounded-xl p-3');
        const top = el('div','flex items-center justify-between mb-2');
        top.append(el('div','font-medium',label));
        const add = button('text-xs text-[var(--primary)]','+ Ho·∫°t ƒë·ªông');
        add.onclick = ()=>{ db.routine[d][blockId].push({id:uid(),title:'',notes:'',recurring:true}); save(); draw(); };
        top.append(add); box.append(top);
        const list = el('div','space-y-2');
        db.routine[d][blockId].forEach((it,idx)=>{
          const row = el('div','grid grid-cols-12 gap-2 items-center');
          const title = input('border rounded-xl p-2 col-span-5', it.title, 'Ti√™u ƒë·ªÅ');
          const notes = input('border rounded-xl p-2 col-span-5', it.notes, 'Ghi ch√∫/Th·ªùi l∆∞·ª£ng');
          const loop = el('label','col-span-1 text-xs flex items-center gap-1');
          const cb = document.createElement('input'); cb.type='checkbox'; cb.checked=!!it.recurring; cb.onchange=()=>{ it.recurring=cb.checked; save(); };
          loop.append(cb, el('span','', 'Loop'));
          const del = button('text-xs text-red-500 col-span-1','Xo√°'); del.onclick=()=>{ db.routine[d][blockId].splice(idx,1); save(); draw(); };
          title.oninput=()=>{ it.title=title.value; save(); };
          notes.oninput=()=>{ it.notes=notes.value; save(); };
          row.append(title,notes,loop,del);
          list.append(row);
        });
        box.append(list);
        return box;
      }

      timeBlocks.forEach(b=> grid.append(blockUI(b.id,b.label)));

      const evs = db.routine[d].events;
      if(evs.length){
        const evWrap = el('div','mt-3');
        evWrap.append(el('div','font-medium mb-1','S·ª± ki·ªán'));
        evs.forEach((ev,idx)=>{
          const row = el('div','grid grid-cols-12 gap-2 items-center');
          const t = input('border rounded-xl p-2 col-span-5', ev.title, 'Ti√™u ƒë·ªÅ');
          const time = input('border rounded-xl p-2 col-span-3', ev.time||'', 'HH:MM');
          const note = input('border rounded-xl p-2 col-span-3', ev.notes||'', 'Ghi ch√∫');
          const del = button('text-xs text-red-500 col-span-1','Xo√°');
          t.oninput=()=>{ ev.title=t.value; save(); };
          time.oninput=()=>{ ev.time=time.value; save(); };
          note.oninput=()=>{ ev.notes=note.value; save(); };
          del.onclick=()=>{ db.routine[d].events.splice(idx,1); save(); draw(); };
          row.append(t,time,note,del); evWrap.append(row);
        })
        dayCard.append(evWrap);
      }

      wrap.append(dayCard);
      function draw(){ renderRoutine(); }
    })
  }

  // Todos
  function renderTodos(){
    byId('todayBadge').textContent = todayISO();
    const groups = {};
    for(const t of db.todos){ (groups[t.due] ||= []).push(t); }
    const sorted = Object.entries(groups).sort(([a],[b])=> a<b? -1:1);
    const wrap = byId('todoGroups'); wrap.innerHTML='';
    sorted.forEach(([date, items])=>{
      const box = el('div','border rounded-2xl p-3');
      box.append(el('div','font-medium mb-2', date));
      items.forEach((t)=>{
        const row = el('div','flex items-center justify-between gap-3');
        const label = el('label','flex items-center gap-2 flex-1' + (t.done? ' line-through text-slate-400':''));
        const cb = document.createElement('input'); cb.type='checkbox'; cb.checked=!!t.done; cb.onchange=()=>{ t.done=cb.checked; save(); renderTodos(); };
        const span = el('span','', t.text);
        label.append(cb, span);
        const del = button('text-xs text-red-500','Xo√°'); del.onclick=()=>{ db.todos = db.todos.filter(x=>x.id!==t.id); save(); renderTodos(); };
        row.append(label,del); box.append(row);
      })
      wrap.append(box);
    })
  }

  // Topbar actions
  function attachTopbar(){
    byId('exportBtn').onclick = ()=>{
      const blob = new Blob([JSON.stringify(db,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = `personal_hub_${todayISO()}.json`; a.click(); URL.revokeObjectURL(url);
    };
    byId('importInput').addEventListener('change', (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{ db = JSON.parse(reader.result.toString()); save(); location.reload(); }
        catch(err){ alert('Import l·ªói: '+err); }
      };
      reader.readAsText(f);
    });
    byId('buildTomorrowBtn').onclick = ()=>{
      const today = todayISO();
      const tomorrow = addDays(today,1);
      const undone = db.todos.filter(t=> t.due===today && !t.done);
      if(!undone.length){ notify('Kh√¥ng c√≥ vi·ªác t·ªìn ƒë·ªçng h√¥m nay. Great job!'); return; }
      db.todos = db.todos.map(t=> (t.due===today && !t.done)? {...t, due: tomorrow}: t);
      save(); renderTodos();
      notify(`ƒê√£ chuy·ªÉn ${undone.length} vi·ªác sang ng√†y mai (${tomorrow}).`);
    };

    // add todo
    const todoText = byId('todoText');
    const todoDue = byId('todoDue'); todoDue.value = todayISO();
    byId('todoAdd').onclick = ()=>{
      const text = (todoText.value||'').trim(); if(!text) return;
      db.todos.push({id:uid(), text, due: todoDue.value || todayISO(), done:false});
      todoText.value=''; save(); renderTodos();
    };

    // explicit saves for timetable & routine
    const st = document.getElementById('saveTimetable'); if(st) st.onclick = ()=>{ save(); notify('ƒê√£ l∆∞u th·ªùi kho√° bi·ªÉu'); };
    const sr = document.getElementById('saveRoutine'); if(sr) sr.onclick = ()=>{ save(); notify('ƒê√£ l∆∞u l·ªãch sinh ho·∫°t'); };
  }

  // Auto carry-over on day change since last open
  function autoCarryOverIfNewDay(){
    const last = db.meta?.lastOpened || todayISO();
    const today = todayISO();
    if(last !== today){
      db.todos = db.todos.map(t=> (t.due < today && !t.done) ? {...t, due: today}: t);
      notify('ƒê√£ k·∫øt chuy·ªÉn vi·ªác ch∆∞a xong t·ª´ '+ last +' sang '+ today);
    }
    db.meta = {...(db.meta||{}), lastOpened: today};
    save();
  }

  // DOM helpers
  function byId(id){return document.getElementById(id)}
  function el(tag, cls, text){ const x=document.createElement(tag); if(cls) x.className=cls; if(text!=null) x.textContent=text; return x; }
  function input(cls, value, placeholder, type='text'){ const i=document.createElement('input'); i.type=type; i.className=cls; i.placeholder=placeholder||''; i.value = value ?? ''; return i; }
  function button(cls, text){ const b=document.createElement('button'); b.className=cls; b.textContent=text; return b; }
})();
</script>
</body>
</html>
